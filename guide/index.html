<!doctype html><html lang=zh-cn><head><meta charset=utf-8><title>技术指南 | 火山岩</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="guide"><meta name=author content><link rel=canonical href=https://tooltakes.github.io/guide/><link rel=stylesheet href=https://tooltakes.github.io/sass/main.min.css><link rel=stylesheet href=https://tooltakes.github.io/sass/nav.min.css><link rel=stylesheet href=https://tooltakes.github.io/fonts/font.css><link rel=stylesheet href=https://tooltakes.github.io/plugins/css/pico.min.css><link rel=stylesheet href=https://tooltakes.github.io/css/igneous.css><script defer crossorigin=anonymous src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://tooltakes.github.io/uploads/zap.svg><link rel=icon type=image/png sizes=16x16 href=https://tooltakes.github.io/uploads/zap.svg><link rel=icon type=image/png sizes=32x32 href=https://tooltakes.github.io/uploads/zap.svg><link rel=apple-touch-icon href=https://tooltakes.github.io/uploads/zap.svg><link rel=mask-icon href=https://tooltakes.github.io/uploads/zap.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.112.0-DEV"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tooltakes.github.io/uploads/og.svg"><meta name=twitter:title content="技术指南"><meta name=twitter:description content="guide"><meta property="og:title" content="技术指南"><meta property="og:description" content="guide"><meta property="og:type" content="article"><meta property="og:url" content="https://tooltakes.github.io/guide/"><meta property="og:image" content="https://tooltakes.github.io/uploads/og.svg"><meta property="article:section" content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://tooltakes.github.io/uploads/og.svg"><meta name=twitter:title content="技术指南"><meta name=twitter:description content="guide"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"技术指南","item":"https://tooltakes.github.io/guide/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"技术指南","name":"技术指南","description":"guide","keywords":[],"articleBody":"主流的ACME客户端配置方式 设置acme域名，例如：ca.mydomain 添加根证书到操作系统或浏览器 添加DNS记录 参考如下方式配置WEB服务器 Certbot Certbot 是所有ACME客户的起始。它由EFF构建和支持，是生产级ACME命令行的标准。\n我们建议大多数人从 Certbot 客户端开始。 它既可以只为您获取证书，也可以帮助您获取并安装证书。 它易于使用，适用于许多操作系统，并且具有出色的文档。\n如果 Certbot 不能满足您的需求，或者您只是想尝试其他软件，那么下面有更多的客户端可供选择，这些客户端按照编写所用的语言或是使用环境排序。\nREQUESTS_CA_BUNDLE=${MY_CA_ROOT_DIR}/root_ca.crt \\ certbot certonly -n --standalone -d foo.mydomain \\ --server https://ca.mydomain/acme/acme/directory 因为需要完成http-01挑战，请确保certbot有侦听80端口的权限。如果您已经有一个正在运行的网络服务器，您可以改用webroot模式。同时，certbot还支持dns-01挑战。\n您可以通过运行更新所有已安装的证书cerbot：\nREQUESTS_CA_BUNDLE=${MY_CA_ROOT_DIR}/root_ca.crt certbot renew 您可以通过一个简单的条目自动续订cron，每日触发更新：\n* * * 1/1 * ? root REQUESTS_CA_BUNDLE=${MY_CA_ROOT_DIR}/root_ca.crt certbot -q renew 某些Linux发行版的软件包certbot，会为您创建这样的cron条目或systemd计时器。您还需要将您的域名配置为仅在证书到期后一天内更新证书，方法是添加如下一行：\nrenew_before_expiry = 24 hours acme.sh acme.sh是另一个流行的命令行 ACME 客户端。它完全用 shell（bash、dash和sh兼容的）编写，几乎没有依赖性：\nacme.sh --issue --standalone -d foo.mydomain \\ --server https://ca.mydomain/acme/acme/directory \\ --ca-bundle ${MY_CA_ROOT_DIR}/root_ca.crt \\ --fullchain-file foo.crt \\ --key-file foo.key 以合理的频率强制更新，例如每 8 小时一次，通过 cron：\n0 */8 * * * root \"/home//.acme.sh\"/acme.sh --cron --home \"/home//.acme.sh\" --force \u003e /dev/null win-acme win-acme ( wacs.exe) 是一个在 Windows 上流行的 ACME 客户端。 要使用win-acme，您需要执行以下操作：\n更改settings.json中的端点配置为：https://ca.mydomain/acme/acme/ ，或者通过–baseuri进行设置。 建议使用tls-alpn-01质询类型来证明所有权。\nCaddy Caddy是一个 HTTP/2 网络服务器，具有由集成的 ACME 客户端提供支持的自动 HTTPS 。除了为静态网站提供服务外，Caddy 通常用作 TLS 网关代理。\n这是一个Caddyfile配置示例，用以自动获取ca.mydomain证书：\n{ email oa@myoffice.org acme_ca https://ca.mydomain/acme/acme/directory } foo.mydomain root * /var/www tls oa@myoffice.org { ca https://ca.mydomain/acme/acme/directory } Nginx Nginx本身不支持 ACME，但您可以使用 Certbot 或 acme.sh 来获取 Nginx 使用的证书。\n这是一个nginx.conf在常见配置中运行 Nginx 的示例：：\nserver { listen 443 ssl; server_name foo.mydomain; ssl_certificate /path/to/foo.crt; ssl_certificate_key /path/to/foo.key; location / { proxy_pass http://127.0.0.1:8000 } } Nginx 仅在启动时读取一次证书。当您更新磁盘上的证书时，Nginx 不会注意到。每次续订后，您需要运行以下命令：\nnginx -s reload Apache Apache httpd 通过mod_md集成了 ACME 支持。您可以采用类似于我们为 Nginx 所做的方式将证书部署到 Apache。\n这是 Apache 配置示例：\nServerName foo.mydomain DocumentRoot /home/mmalone/www SSLEngine on SSLCertificateFile /etc/letsencrypt/live/foo.mydomain/fullchain.pem SSLCertificateKeyFile /etc/letsencrypt/live/foo.mydomain/privkey.pem 与 Nginx 一样，Apache 需要在通过运行以下命令更新证书后发出信号：\napachectl graceful ","wordCount":"196","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"火山岩项目组"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tooltakes.github.io/guide/"},"publisher":{"@type":"Organization","name":"火山岩","logo":{"@type":"ImageObject","url":"https://tooltakes.github.io/uploads/zap.svg"}}}</script></head><body><nav class=desktop><ul><li><a class=logo href=https://tooltakes.github.io/ accesskey=h title="为您的网络安全保驾护航 (Alt + h)"><img id=lightMainIcon src=/uploads/zap.svg alt=为您的网络安全保驾护航 width=35 height=35></img>
<img id=darkMainIcon src=/uploads/zap.svg alt=为您的网络安全保驾护航 width=35 height=35></img><h3 style=margin-bottom:0><strong><em>火山岩</em></strong></h3></a></li><li class=toggle-container><input type=checkbox id=switch>
<label for=switch><i id=darkIcon data-feather=moon></i>
<i id=lightIcon data-feather=sun></i></label></li></ul><ul class=desktop-navigation><li><a href=/detail title=详情><i data-feather=shield></i>
<span>详情</span></a></li><li><a href=/search title=搜索><i data-feather=search></i>
<span>搜索</span></a></li><li><a href=/guide title=技术指南><i data-feather=terminal></i>
<span class=menu-active>技术指南</span></a></li><li><a href=/contact title=联系我们><i data-feather=mail></i>
<span>联系我们</span></a></li></ul><ul class=mobile-navigation><li><button id=menuOpen onclick=openMobile() aria-label="Menu closed">
<i data-feather=menu></i></button>
<button id=menuClose onclick=openMobile() aria-label="Menu opened">
<i data-feather=x></i></button></li></ul></nav><aside class=sidebar id=mobileNav style=display:none><nav><ul><li><a href=/detail title=详情><span><i data-feather=shield></i>
详情</span></a></li><li><a href=/search title=搜索><span><i data-feather=search></i>
搜索</span></a></li><li><a href=/guide title=技术指南><span class=menu-active><i data-feather=terminal></i>
技术指南</span></a></li><li><a href=/contact title=联系我们><span><i data-feather=mail></i>
联系我们</span></a></li></ul></nav></aside><main><div class=container><hgroup><h1>技术指南</h1><p></p></hgroup><div class="grid grid-main"><div><article class=toc><div><details><summary accesskey=c title="(Alt + C)"><span>Table of Contents</span></summary><div><ul><li><a href=#%e4%b8%bb%e6%b5%81%e7%9a%84acme%e5%ae%a2%e6%88%b7%e7%ab%af%e9%85%8d%e7%bd%ae%e6%96%b9%e5%bc%8f aria-label=主流的ACME客户端配置方式>主流的ACME客户端配置方式</a><ul><li><a href=#certbot aria-label=Certbot>Certbot</a></li><li><a href=#acmesh aria-label=acme.sh>acme.sh</a></li><li><a href=#win-acme aria-label=win-acme>win-acme</a></li><li><a href=#caddy aria-label=Caddy>Caddy</a></li><li><a href=#nginx aria-label=Nginx>Nginx</a></li><li><a href=#apache aria-label=Apache>Apache</a></li></ul></li></ul></div></details></div></article><div class=post><h2 id=主流的acme客户端配置方式>主流的ACME客户端配置方式<a class=anchor aria-hidden=true href=#主流的acme客户端配置方式>#</a></h2><ul><li>设置acme域名，例如：ca.mydomain</li><li>添加根证书到操作系统或浏览器</li><li>添加DNS记录</li><li>参考如下方式配置WEB服务器</li></ul><h3 id=certbot>Certbot<a class=anchor aria-hidden=true href=#certbot>#</a></h3><p><img src=/uploads/certbot.svg#center alt></p><p>Certbot 是所有ACME客户的起始。它由EFF构建和支持，是生产级ACME命令行的标准。</p><p>我们建议大多数人从 Certbot 客户端开始。 它既可以只为您获取证书，也可以帮助您获取并安装证书。 它易于使用，适用于许多操作系统，并且具有出色的文档。</p><p>如果 Certbot 不能满足您的需求，或者您只是想尝试其他软件，那么下面有更多的客户端可供选择，这些客户端按照编写所用的语言或是使用环境排序。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>REQUESTS_CA_BUNDLE<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>MY_CA_ROOT_DIR<span style=color:#e6db74>}</span>/root_ca.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    certbot certonly -n --standalone -d foo.mydomain <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --server https://ca.mydomain/acme/acme/directory
</span></span></code></pre></div><p>因为需要完成http-01挑战，请确保certbot有侦听80端口的权限。如果您已经有一个正在运行的网络服务器，您可以改用webroot模式。同时，certbot还支持dns-01挑战。</p><p>您可以通过运行更新所有已安装的证书cerbot：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>REQUESTS_CA_BUNDLE<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>MY_CA_ROOT_DIR<span style=color:#e6db74>}</span>/root_ca.crt certbot renew
</span></span></code></pre></div><p>您可以通过一个简单的条目自动续订cron，每日触发更新：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>* * * 1/1 * ? root REQUESTS_CA_BUNDLE<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>MY_CA_ROOT_DIR<span style=color:#e6db74>}</span>/root_ca.crt certbot -q renew
</span></span></code></pre></div><p>某些Linux发行版的软件包certbot，会为您创建这样的cron条目或systemd计时器。您还需要将您的域名配置为仅在证书到期后一天内更新证书，方法是添加如下一行：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a6e22e>renew_before_expiry</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>24 hours</span>
</span></span></code></pre></div><h3 id=acmesh>acme.sh<a class=anchor aria-hidden=true href=#acmesh>#</a></h3><p><img src=/uploads/acme.sh.svg#center alt></p><p>acme.sh是另一个流行的命令行 ACME 客户端。它完全用 shell（bash、dash和sh兼容的）编写，几乎没有依赖性：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>acme.sh --issue --standalone -d foo.mydomain <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --server https://ca.mydomain/acme/acme/directory <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --ca-bundle <span style=color:#e6db74>${</span>MY_CA_ROOT_DIR<span style=color:#e6db74>}</span>/root_ca.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --fullchain-file foo.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    --key-file foo.key
</span></span></code></pre></div><p>以合理的频率强制更新，例如每 8 小时一次，通过 cron：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ae81ff>0</span> */8 * * * root <span style=color:#e6db74>&#34;/home/&lt;user&gt;/.acme.sh&#34;</span>/acme.sh --cron --home <span style=color:#e6db74>&#34;/home/&lt;user&gt;/.acme.sh&#34;</span> --force &gt; /dev/null
</span></span></code></pre></div><h3 id=win-acme>win-acme<a class=anchor aria-hidden=true href=#win-acme>#</a></h3><p><img src=/uploads/win-acme.svg#center alt></p><p>win-acme ( wacs.exe) 是一个在 Windows 上流行的 ACME 客户端。
要使用win-acme，您需要执行以下操作：</p><p>更改settings.json中的端点配置为：https://ca.mydomain/acme/acme/ ，或者通过&ndash;baseuri进行设置。
建议使用tls-alpn-01质询类型来证明所有权。</p><h3 id=caddy>Caddy<a class=anchor aria-hidden=true href=#caddy>#</a></h3><p><img src=/uploads/caddy.svg#center alt></p><p>Caddy是一个 HTTP/2 网络服务器，具有由集成的 ACME 客户端提供支持的自动 HTTPS 。除了为静态网站提供服务外，Caddy 通常用作 TLS 网关代理。</p><p>这是一个Caddyfile配置示例，用以自动获取ca.mydomain证书：</p><pre tabindex=0><code class=language-conf data-lang=conf>{
  email oa@myoffice.org
  acme_ca https://ca.mydomain/acme/acme/directory
}

foo.mydomain

root * /var/www
tls oa@myoffice.org {
  ca https://ca.mydomain/acme/acme/directory
}
</code></pre><h3 id=nginx>Nginx<a class=anchor aria-hidden=true href=#nginx>#</a></h3><p><img src=/uploads/nginx.svg#center alt></p><p>Nginx本身不支持 ACME，但您可以使用 Certbot 或 acme.sh 来获取 Nginx 使用的证书。</p><p>这是一个nginx.conf在常见配置中运行 Nginx 的示例：：</p><pre tabindex=0><code class=language-conf data-lang=conf>server {
  listen 443 ssl;
  server_name foo.mydomain;
  ssl_certificate /path/to/foo.crt;
  ssl_certificate_key /path/to/foo.key;
  location / {
    proxy_pass http://127.0.0.1:8000
  }
}
</code></pre><p>Nginx 仅在启动时读取一次证书。当您更新磁盘上的证书时，Nginx 不会注意到。每次续订后，您需要运行以下命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>nginx -s reload
</span></span></code></pre></div><h3 id=apache>Apache<a class=anchor aria-hidden=true href=#apache>#</a></h3><p><img src=/uploads/httpd.svg#center alt></p><p>Apache httpd 通过mod_md集成了 ACME 支持。您可以采用类似于我们为 Nginx 所做的方式将证书部署到 Apache。</p><p>这是 Apache 配置示例：</p><pre tabindex=0><code>&lt;VirtualHost *:443&gt;
  ServerName foo.mydomain
  DocumentRoot /home/mmalone/www
  SSLEngine on
  SSLCertificateFile /etc/letsencrypt/live/foo.mydomain/fullchain.pem
  SSLCertificateKeyFile /etc/letsencrypt/live/foo.mydomain/privkey.pem
&lt;/VirtualHost&gt;
</code></pre><p>与 Nginx 一样，Apache 需要在通过运行以下命令更新证书后发出信号：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>apachectl graceful
</span></span></code></pre></div></div></div></div></div></main><footer class=text-center><span>&copy; 2023 成都近水楼台科技有限公司<br><a href=https://beian.miit.gov.cn/ target=_blank rel=noopener>ICP备xxxx号</a><br><a href=/legal/privacy>隐私权政策</a></span></footer><article class=hidden id=cookie-banner><div><span>要使本网站正常工作，您需要在浏览器中启用 cookie。</span></div><footer><a role=button id=consent-cookies>Close</a>
<a role=button class=secondary href=/legal/privacy/#Cookies>Cookies 政策</a></footer></article><script async src=https://tooltakes.github.io/js/cookie.min.js layout=container></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script src=https://tooltakes.github.io/plugins/js/feather.min.js layout=container></script>
<script src=https://tooltakes.github.io/js/script.min.js layout=container></script></body></html>